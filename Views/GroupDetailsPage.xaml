<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="StudyBuddyMobile.Views.GroupDetailsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Group Details"
             BackgroundColor="#f8fafc">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header Section -->
        <Frame Grid.Row="0"
               BackgroundColor="#4f46e5"
               CornerRadius="20"
               Padding="20"
               Margin="0,0,0,10"
               HasShadow="True">
            <VerticalStackLayout Spacing="10">

                <!-- Group Name and Subject -->
                <Label x:Name="GroupNameLabel"
                       Text="Loading..."
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center" />

                <Label x:Name="SubjectLabel"
                       Text="Subject"
                       FontSize="14"
                       TextColor="White"
                       Opacity="0.9"
                       HorizontalOptions="Center" />

                <!-- Group Info Row -->
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15" Margin="0,10,0,0">

                    <!-- Members -->
                    <Frame Grid.Column="0"
                           BackgroundColor="White"
                           CornerRadius="10"
                           Padding="10"
                           Opacity="0.95">
                        <VerticalStackLayout Spacing="3">
                            <Label x:Name="MemberCountLabel"
                                   Text="0/10"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#4f46e5" />
                            <Label Text="Members"
                                   FontSize="11"
                                   HorizontalOptions="Center"
                                   TextColor="#6b7280" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Messages -->
                    <Frame Grid.Column="1"
                           BackgroundColor="White"
                           CornerRadius="10"
                           Padding="10"
                           Opacity="0.95">
                        <VerticalStackLayout Spacing="3">
                            <Label x:Name="MessageCountLabel"
                                   Text="0"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#10b981" />
                            <Label Text="Messages"
                                   FontSize="11"
                                   HorizontalOptions="Center"
                                   TextColor="#6b7280" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Status -->
                    <Frame Grid.Column="2"
                           BackgroundColor="White"
                           CornerRadius="10"
                           Padding="10"
                           Opacity="0.95">
                        <VerticalStackLayout Spacing="3">
                            <Label x:Name="StatusLabel"
                                   Text="Member"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#f59e0b" />
                            <Label Text="Your Role"
                                   FontSize="11"
                                   HorizontalOptions="Center"
                                   TextColor="#6b7280" />
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

            </VerticalStackLayout>
        </Frame>

        <!-- Main Content - Tabs -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*">

            <!-- Tab Header -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*" ColumnSpacing="0" Margin="20,0">
                <Button Grid.Column="0"
                        x:Name="ChatTabButton"
                        Text="💬 Chat"
                        FontSize="14"
                        FontAttributes="Bold"
                        BackgroundColor="#4f46e5"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Clicked="OnTabClicked" />

                <Button Grid.Column="1"
                        x:Name="MembersTabButton"
                        Text="👥 Members"
                        FontSize="14"
                        FontAttributes="Bold"
                        BackgroundColor="#e5e7eb"
                        TextColor="#6b7280"
                        CornerRadius="10"
                        HeightRequest="40"
                        Clicked="OnTabClicked" />
            </Grid>

            <!-- Tab Content -->
            <Frame Grid.Row="1" 
                   BackgroundColor="White"
                   CornerRadius="20"
                   Padding="0"
                   Margin="20,0"
                   HasShadow="True">

                <!-- Single container to hold both tab contents -->
                <Grid>
                    <!-- Chat Tab Content -->
                    <Grid x:Name="ChatTabContent" IsVisible="True" RowDefinitions="*,Auto" Padding="0">

                        <!-- Messages List -->
                        <ScrollView Grid.Row="0" x:Name="MessagesScrollView" Padding="15" BackgroundColor="#f8fafc">
                            <StackLayout x:Name="MessagesContainer" Spacing="10">

                                <!-- Empty Chat State -->
                                <Frame x:Name="EmptyChatFrame"
                                       BackgroundColor="#f8fafc"
                                       CornerRadius="10"
                                       Padding="30"
                                       IsVisible="True"
                                       HasShadow="False">
                                    <VerticalStackLayout Spacing="10">
                                        <Label Text="💬"
                                               FontSize="36"
                                               HorizontalOptions="Center" />
                                        <Label Text="No messages yet!"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"
                                               TextColor="#1f2937" />
                                        <Label Text="Start the conversation by sending the first message."
                                               FontSize="12"
                                               HorizontalOptions="Center"
                                               TextColor="#6b7280" />
                                    </VerticalStackLayout>
                                </Frame>

                            </StackLayout>
                        </ScrollView>

                        <!-- Message Input - Fixed at Bottom -->
                        <Border Grid.Row="1" 
                                BackgroundColor="White" 
                                StrokeThickness="1" 
                                Stroke="#e5e7eb">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="0,0,20,20" />
                            </Border.StrokeShape>

                            <Grid ColumnDefinitions="*,Auto" 
                                  ColumnSpacing="10" 
                                  Padding="15"
                                  BackgroundColor="White">

                                <Border Grid.Column="0" 
                                        StrokeThickness="1" 
                                        Stroke="#d1d5db"
                                        BackgroundColor="#f9fafb">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="25" />
                                    </Border.StrokeShape>

                                    <Entry x:Name="MessageEntry"
                                           Placeholder="Type your message..."
                                           FontSize="14"
                                           TextColor="#111827"
                                           BackgroundColor="Transparent"
                                           ReturnType="Send"
                                           Completed="OnSendMessageClicked"
                                           Margin="15,0" />
                                </Border>

                                <Button Grid.Column="1"
                                        x:Name="SendButton"
                                        Text="📤"
                                        FontSize="18"
                                        BackgroundColor="#4f46e5"
                                        TextColor="White"
                                        CornerRadius="25"
                                        WidthRequest="50"
                                        HeightRequest="50"
                                        Clicked="OnSendMessageClicked" />
                            </Grid>
                        </Border>

                    </Grid>

                    <!-- Members Tab Content -->
                    <StackLayout x:Name="MembersTabContent" IsVisible="False" Padding="15">

                        <ScrollView>
                            <StackLayout x:Name="MembersContainer" Spacing="10">

                                <!-- Group Description -->
                                <Frame x:Name="DescriptionFrame"
                                       BackgroundColor="#f0f9ff"
                                       CornerRadius="10"
                                       Padding="15"
                                       HasShadow="False"
                                       IsVisible="False">
                                    <VerticalStackLayout Spacing="8">
                                        <Label Text="📋 About this group"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#1e40af" />
                                        <Label x:Name="DescriptionLabel"
                                               Text=""
                                               FontSize="13"
                                               TextColor="#374151" />
                                    </VerticalStackLayout>
                                </Frame>

                            </StackLayout>
                        </ScrollView>
                    </StackLayout>
                </Grid>

            </Frame>
        </Grid>

        <!-- Action Buttons -->
        <Frame Grid.Row="2"
               BackgroundColor="White"
               CornerRadius="20"
               Padding="20"
               HasShadow="True">
            <StackLayout x:Name="ActionButtonsContainer" Spacing="10">

                <!-- Join Button (for non-members) -->
                <Button x:Name="JoinButton"
                        Text="➕ Join Group"
                        FontSize="16"
                        FontAttributes="Bold"
                        BackgroundColor="#10b981"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="45"
                        IsVisible="False"
                        Clicked="OnJoinGroupClicked" />

                <!-- Member Actions -->
                <Grid x:Name="MemberActions" ColumnDefinitions="*,*" ColumnSpacing="10" IsVisible="False">
                    <Button Grid.Column="0"
                            x:Name="LeaveButton"
                            Text="🚪 Leave Group"
                            FontSize="14"
                            FontAttributes="Bold"
                            BackgroundColor="#ef4444"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            Clicked="OnLeaveGroupClicked" />

                    <Button Grid.Column="1"
                            x:Name="RefreshButton"
                            Text="🔄 Refresh"
                            FontSize="14"
                            FontAttributes="Bold"
                            BackgroundColor="#6b7280"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            Clicked="OnRefreshClicked" />
                </Grid>

                <!-- Creator Actions -->
                <Grid x:Name="CreatorActions" ColumnDefinitions="*,*" ColumnSpacing="10" IsVisible="False">
                    <Button Grid.Column="0"
                            x:Name="ManageButton"
                            Text="⚙️ Manage"
                            FontSize="14"
                            FontAttributes="Bold"
                            BackgroundColor="#f59e0b"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            Clicked="OnManageGroupClicked" />

                    <Button Grid.Column="1"
                            x:Name="DeleteButton"
                            Text="🗑️ Delete"
                            FontSize="14"
                            FontAttributes="Bold"
                            BackgroundColor="#ef4444"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            Clicked="OnDeleteGroupClicked" />
                </Grid>

            </StackLayout>
        </Frame>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1"
                         x:Name="LoadingIndicator"
                         IsVisible="False"
                         IsRunning="False"
                         Color="#4f46e5"
                         VerticalOptions="Center"
                         HorizontalOptions="Center" />

    </Grid>

</ContentPage>